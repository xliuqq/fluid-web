(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{443:function(a,e,t){"use strict";t.r(e);var s=t(19),n=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"示例-dataset手动扩缩容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#示例-dataset手动扩缩容"}},[a._v("#")]),a._v(" 示例 - Dataset手动扩缩容")]),a._v(" "),e("h2",{attrs:{id:"前提条件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[a._v("#")]),a._v(" 前提条件")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/fluid-cloudnative/fluid",target:"_blank",rel:"noopener noreferrer"}},[a._v("Fluid"),e("OutboundLink")],1),a._v("(version >= 0.5.0)")])]),a._v(" "),e("p",[a._v("请参考"),e("RouterLink",{attrs:{to:"/zh/guide/install.html"}},[a._v("Fluid安装文档")]),a._v("完成安")],1),a._v(" "),e("h2",{attrs:{id:"新建工作环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新建工作环境"}},[a._v("#")]),a._v(" 新建工作环境")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("any-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dataset_scale\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("any-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dataset_scale\n")])])]),e("h2",{attrs:{id:"运行示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行示例"}},[a._v("#")]),a._v(" 运行示例")]),a._v(" "),e("p",[e("strong",[a._v("创建Dataset和AlluxioRuntime资源对象")])]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[a._v("$ cat << EOF "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v(" dataset.yaml\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" data.fluid.io/v1alpha1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Dataset\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" hbase\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mounts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mountPoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//mirrors.tuna.tsinghua.edu.cn/apache/hbase/stable/\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" hbase\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("---")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" data.fluid.io/v1alpha1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" AlluxioRuntime\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" hbase\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tieredstore")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("levels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mediumtype")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" MEM\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /dev/shm\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("quota")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 2Gi\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("high")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0.95"')]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("low")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0.7"')]),a._v("\nEOF\n")])])]),e("p",[a._v("在上述示例中，我们设置"),e("code",[a._v("AlluxioRuntime.spec.replicas")]),a._v("为1，这意味着我们将启动一个带有一个Worker的Alluxio集群来缓存数据集中的数据。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl create -f dataset.yaml\ndataset.data.fluid.io/hbase created\nalluxioruntime.data.fluid.io/hbase created\n")])])]),e("p",[a._v("待Alluxio集群正常启动后，可以看到此时创建出来的Dataset以及AlluxioRuntime处于如下状态：")]),a._v(" "),e("p",[a._v("Alluxio各组件运行状态：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get pod\nNAME                 READY   STATUS    RESTARTS   AGE\nhbase-master-0       2/2     Running   0          3m50s\nhbase-worker-0       2/2     Running   0          3m15s\n")])])]),e("p",[a._v("Dataset状态：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get dataset hbase\nNAME    UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\nhbase   544.77MiB        0.00B    2.00GiB          0.0%                Bound   3m28s\n")])])]),e("p",[a._v("AlluxioRuntime状态：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get alluxioruntime hbase -o wide\nNAME    READY MASTERS   DESIRED MASTERS   MASTER PHASE   READY WORKERS   DESIRED WORKERS   WORKER PHASE   READY FUSES   DESIRED FUSES   FUSE PHASE   AGE\nhbase   1               1                 Ready          1               1                 Ready          0             0               Ready        4m55s\n")])])]),e("p",[e("strong",[a._v("Dataset扩容")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl scale alluxioruntime hbase --replicas=2\nalluxioruntime.data.fluid.io/hbase scaled\n")])])]),e("p",[a._v("直接使用"),e("code",[a._v("kubectl scale")]),a._v("命令即可完成Dataset的扩容操作。在成功执行上述命令并等待一段时间后可以看到Dataset以及AlluxioRuntime的状态均发生了变化：")]),a._v(" "),e("p",[a._v("一个新的Alluxio Worker以及对应的Alluxio Fuse组件成功启动：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get pod\nNAME                 READY   STATUS    RESTARTS   AGE\nhbase-master-0       2/2     Running   0          13m\nhbase-worker-0       2/2     Running   0          13m\nhbase-worker-1       2/2     Running   0          6m49s\n")])])]),e("p",[a._v("Dataset中的"),e("code",[a._v("Cache Capacity")]),a._v("从原来的"),e("code",[a._v("2.00GiB")]),a._v("变为"),e("code",[a._v("4.00GiB")]),a._v("，表明该Dataset的可用缓存容量增加：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get dataset hbase\nNAME    UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\nhbase   544.77MiB        0.00B    4.00GiB          0.0%                Bound   15m\n")])])]),e("p",[a._v("AlluxioRuntime中的"),e("code",[a._v("Ready Workers")]),a._v("以及"),e("code",[a._v("Ready Fuses")]),a._v("属性均变为2：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get alluxioruntime hbase -o wide\nNAME    READY MASTERS   DESIRED MASTERS   MASTER PHASE   READY WORKERS   DESIRED WORKERS   WORKER PHASE   READY FUSES   DESIRED FUSES   FUSE PHASE   AGE\nhbase   1               1                 Ready          2               2                 Ready          0             0               Ready        17m\n")])])]),e("p",[a._v("查看AlluxioRuntime的具体描述信息可以了解最新的扩缩容信息：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl describe alluxioruntime hbase\n...\n  Conditions:\n    ...\n    Last Probe Time:                2021-04-23T07:54:03Z\n    Last Transition Time:           2021-04-23T07:54:03Z\n    Message:                        The workers are scale out.\n    Reason:                         Workers scaled out\n    Status:                         True\n    Type:                           WorkersScaledOut\n...\nEvents:\n  Type    Reason   Age   From            Message\n  ----    ------   ----  ----            -------\n  Normal  Succeed  2m2s  AlluxioRuntime  Runtime scaled out. current replicas: 2, desired replicas: 2.\n")])])]),e("p",[e("strong",[a._v("Dataset缩容")])]),a._v(" "),e("p",[a._v("与扩容类似，缩容时同样可以使用"),e("code",[a._v("kubectl scale")]),a._v("对Runtime的Worker数量进行调整：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl scale alluxioruntime hbase --replicas=1\nalluxioruntime.data.fluid.io/hbase scaled\n")])])]),e("p",[a._v("成功执行上述命令后，"),e("strong",[a._v("如果目前环境中没有应用正在尝试访问该数据集")]),a._v("，那么就会触发Runtime的缩容。")]),a._v(" "),e("p",[a._v("超出指定"),e("code",[a._v("replicas")]),a._v("数量的Runtime Worker将会被停止：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("NAME                 READY   STATUS        RESTARTS   AGE\nhbase-master-0       2/2     Running       0          22m\nhbase-worker-0       2/2     Running       0          21m\nhbase-worker-1       2/2     Terminating   0          17m32s\n")])])]),e("p",[a._v("Dataset的缓存容量("),e("code",[a._v("Cache Capacity")]),a._v(")恢复到"),e("code",[a._v("2.00GiB")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get dataset hbase\nNAME    UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\nhbase   544.77MiB        0.00B    2.00GiB          0.0%                Bound   30m\n")])])]),e("blockquote",[e("p",[a._v("注意：在目前版本的Fluid中，缩容时Dataset中"),e("code",[a._v("Cache Capacity")]),a._v("属性字段的变化存在几分钟的延迟，因此您可能无法迅速观察到这一属性的变化")])]),a._v(" "),e("p",[a._v("AlluxioRuntime中的"),e("code",[a._v("Ready Workers")]),a._v("以及"),e("code",[a._v("Ready Fuses")]),a._v("字段同样变为"),e("code",[a._v("1")]),a._v("：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl get alluxioruntime hbase -o wide\nNAME    READY MASTERS   DESIRED MASTERS   MASTER PHASE   READY WORKERS   DESIRED WORKERS   WORKER PHASE   READY FUSES   DESIRED FUSES   FUSE PHASE   AGE\nhbase   1               1                 Ready          1               1                 Ready          0             0               Ready        30m\n")])])]),e("p",[a._v("查看AlluxioRuntime的具体描述信息可以了解最新的扩缩容信息：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ kubectl describe alluxioruntime hbase\n...\n  Conditions:\n    ...\n    Last Probe Time:                2021-04-23T08:00:55Z\n    Last Transition Time:           2021-04-23T08:00:55Z\n    Message:                        The workers scaled in.\n    Reason:                         Workers scaled in\n    Status:                         True\n    Type:                           WorkersScaledIn\n...\nEvents:\n  Type     Reason               Age    From            Message\n  ----     ------               ----   ----            -------\n  Normal   Succeed              6m56s  AlluxioRuntime  Runtime scaled out. current replicas: 2, desired replicas: 1.\n  Normal   Succeed              4s     AlluxioRuntime  Runtime scaled in. current replicas: 1, desired replicas: 2.\n")])])]),e("p",[a._v("Fluid提供的这种扩缩容能力能够帮助用户或是集群管理员适时地调整数据集缓存所占用的集群资源，减少某个不频繁使用的数据集的缓存容量（缩容），或者按需增加某数据集的缓存容量（扩容），以实现更加精细的资源分配，提高资源利用率。")]),a._v(" "),e("h2",{attrs:{id:"环境清理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境清理"}},[a._v("#")]),a._v(" 环境清理")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ kubectl delete -f dataset.yaml\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);