(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{449:function(s,t,e){"use strict";e.r(t);var a=e(19),r=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"示例-如何在-fluid-中使用-juicefs-同步-s3-中的数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例-如何在-fluid-中使用-juicefs-同步-s3-中的数据"}},[s._v("#")]),s._v(" 示例 - 如何在 Fluid 中使用 JuiceFS 同步 S3 中的数据")]),s._v(" "),t("p",[s._v("JuiceFS 采用「数据」与「元数据」分离存储的架构，从而实现文件系统的分布式设计。使用 JuiceFS 存储数据，数据本身会被持久化在对象存储（例如，Amazon S3），相对应的元数据可以按需持久化在\nRedis、MySQL、TiKV 等多种数据库中。")]),s._v(" "),t("p",[s._v("故而，在 Fluid 中使用 JuiceFS 同步 S3 中已有的数据，需要先将 S3 中的数据初始化到 JuiceFS 中。")]),s._v(" "),t("h2",{attrs:{id:"部署-juicefsruntime-环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署-juicefsruntime-环境"}},[s._v("#")]),s._v(" 部署 JuiceFSRuntime 环境")]),s._v(" "),t("p",[s._v("具体部署方法参考文档 "),t("RouterLink",{attrs:{to:"/zh/samples/juicefs_runtime.html"}},[s._v("如何在 Fluid 中使用 JuiceFS")]),s._v("。")],1),s._v(" "),t("p",[s._v("在 JuiceFSRuntime 和 Dataset 创建成功后，等待 worker pod 启动成功，再进行下面的步骤。")]),s._v(" "),t("h2",{attrs:{id:"数据初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据初始化"}},[s._v("#")]),s._v(" 数据初始化")]),s._v(" "),t("p",[s._v("在 worker pod 中可使用 "),t("code",[s._v("juicefs sync")]),s._v(" 将指定 bucket 的数据同步到 juicefs 中。\n例如，在 bucket "),t("code",[s._v("jfs-test-tmp")]),s._v(" 中有一个文件 "),t("code",[s._v("JuiceFS_logo.png")]),s._v("，在 worker pod 中挂载点为 "),t("code",[s._v("/runtime-mnt/juicefs/default/jfsdemo/juicefs-fuse")]),s._v("，\n按如下操作，可以将其同步到 JuiceFS 中。")]),s._v(" "),t("h3",{attrs:{id:"查看-worker-中的挂载点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-worker-中的挂载点"}},[s._v("#")]),s._v(" 查看 worker 中的挂载点")]),s._v(" "),t("p",[s._v("Worker pod 的挂载点格式为："),t("code",[s._v("/runtime-mnt/juicefs/<namespace>/<runtimeName>/juicefs-fuse")]),s._v("。可以在 worker pod 中通过如下命令查看：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it jfsdemo-worker-0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@jfsdemo-worker-0:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h")]),s._v("\nFilesystem      Size  Used Avail Use% Mounted on\noverlay         100G   29G   72G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("% /\ntmpfs            64M     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   64M   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/sdb1       100G   29G   72G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("% /etc/hosts\nshm              64M     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   64M   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8G   12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8G   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run/secrets/kubernetes.io/serviceaccount\nJuiceFS:minio   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".0P  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".0P   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /runtime-mnt/juicefs/default/jfsdemo/juicefs-fuse\n")])])]),t("h3",{attrs:{id:"使用-juicefs-sync-同步数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-juicefs-sync-同步数据"}},[s._v("#")]),s._v(" 使用 "),t("code",[s._v("juicefs sync")]),s._v(" 同步数据")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it jfsdemo-worker-0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@jfsdemo-worker-0:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# juicefs sync s3://jfs-test-tmp/ /runtime-mnt/juicefs/default/jfsdemo/juicefs-fuse/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/09 07:19:53.852821 juicefs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1995593")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(": Syncing from s3://jfs-test-tmp/ to file:///runtime-mnt/juicefs/default/jfsdemo/juicefs-fuse/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sync.go:571"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nScanned objects count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" / "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n Copied objects count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n Copied objects bytes: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101.75")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104192")]),s._v(" Bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("305.10")]),s._v(" KiB/s\nChecked objects bytes: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" b     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" b/s\nDeleted objects count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nSkipped objects count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Failed objects count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/09 07:19:54.187294 juicefs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1995593")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(": Found: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", copied: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101.75")]),s._v(" KiB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", checked: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B, deleted: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", skipped: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", failed: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sync.go:795"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nroot@jfsdemo-worker-0:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])])]),t("p",[t("code",[s._v("juicefs sync")]),s._v(" 的格式为："),t("code",[s._v("[NAME://][ACCESS_KEY:SECRET_KEY@]BUCKET[.ENDPOINT][/PREFIX]")]),s._v("，具体可参考"),t("a",{attrs:{href:"https://juicefs.com/docs/zh/community/administration/sync",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"检查文件同步结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查文件同步结果"}},[s._v("#")]),s._v(" 检查文件同步结果")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@jfsdemo-worker-0:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /runtime-mnt/juicefs/default/jfsdemo/juicefs-fuse/")]),s._v("\nJuiceFS_logo.png\nroot@jfsdemo-worker-0:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])])]),t("p",[s._v("可以看到 bucket 中的文件已经被同步到了 JuiceFS 中。")]),s._v(" "),t("p",[s._v("最后创建业务 Pod，其中 Pod 使用上面创建的 "),t("code",[s._v("Dataset")]),s._v(" 的方式为指定同名的 PVC。该步骤与文档 "),t("RouterLink",{attrs:{to:"/zh/samples/juicefs_runtime.html"}},[s._v("如何在 Fluid 中使用 JuiceFS")]),s._v(" 中一致，这里不再赘述。")],1)])}),[],!1,null,null,null);t.default=r.exports}}]);