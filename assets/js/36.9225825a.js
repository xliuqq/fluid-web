(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{392:function(e,t,s){"use strict";s.r(t);var a=s(19),n=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"deploy-fluid-on-your-kubernetes-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploy-fluid-on-your-kubernetes-cluster"}},[e._v("#")]),e._v(" Deploy Fluid on Your Kubernetes Cluster")]),e._v(" "),t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),t("ul",[t("li",[e._v("Git")]),e._v(" "),t("li",[e._v("Kubernetes cluster（version >= 1.14）, and support CSI")]),e._v(" "),t("li",[e._v("kubectl（version >= 1.14）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://helm.sh/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Helm"),t("OutboundLink")],1),e._v("（version >= 3.0）")])]),e._v(" "),t("p",[e._v("The following documents assume that you have installed all the above requirements.")]),e._v(" "),t("p",[e._v("For the installation and configuration of kubectl, please refer to "),t("a",{attrs:{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("For the installation and configuration of Helm 3, please refer to "),t("a",{attrs:{href:"https://v3.helm.sh/docs/intro/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"how-to-deploy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how-to-deploy"}},[e._v("#")]),e._v(" How to Deploy")]),e._v(" "),t("h3",{attrs:{id:"download-fluid-chart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#download-fluid-chart"}},[e._v("#")]),e._v(" Download Fluid Chart")]),e._v(" "),t("p",[e._v("You can download the latest Fluid installation package from "),t("a",{attrs:{href:"https://github.com/fluid-cloudnative/fluid/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fluid Releases"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("Untar the Fluid package you just downloaded:")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -zxf fluid.tgz\n")])])]),t("h3",{attrs:{id:"install-fluid-with-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-fluid-with-helm"}},[e._v("#")]),e._v(" Install Fluid with Helm")]),e._v(" "),t("p",[e._v("Create namespace:")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ kubectl create ns fluid-system\n")])])]),t("p",[e._v("Install Fluid with:")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" fluid fluid\nNAME: fluid\nLAST DEPLOYED: Fri Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("24")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16")]),e._v(":10:18 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\nTEST SUITE: None\n")])])]),t("blockquote",[t("p",[e._v("The general format of the "),t("code",[e._v("helm install")]),e._v(" command is like: "),t("code",[e._v("helm install <RELEASE_NAME> <SOURCE>")]),e._v(". In the above command,  the first "),t("code",[e._v("fluid")]),e._v(" means the release name, and the second  "),t("code",[e._v("fluid")]),e._v(" specified the path to the helm chart, i.e. the directory just unpacked.")])]),e._v(" "),t("h3",{attrs:{id:"upgrade-fluid-to-the-latest-version-with-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-fluid-to-the-latest-version-with-helm"}},[e._v("#")]),e._v(" Upgrade Fluid to the latest version with Helm")]),e._v(" "),t("p",[e._v("If you have installed an older version of Fluid before, you can use Helm to upgrade it.\nBefore upgrading, it is recommended to ensure that all components in the AlluxioRuntime resource object have been started completely, which is similar to the following state:")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ kubectl get pod\nNAME                 READY   STATUS    RESTARTS   AGE\nhbase-fuse-chscz     "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          9h\nhbase-fuse-fmhr5     "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          9h\nhbase-master-0       "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          9h\nhbase-worker-bdbjg   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          9h\nhbase-worker-rznd5   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          9h\n")])])]),t("p",[e._v('The command "helm upgrade" will not upgrade CRDs，we need to upgrade them manually：')]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" zxvf fluid-0.5.0.tgz ./\n$ kubectl apply -f fluid/crds/.\n")])])]),t("p",[e._v("upgrade fluid：")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ helm upgrade fluid fluid/\nRelease "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"fluid"')]),e._v(" has been upgraded. Happy Helming"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v("\nNAME: fluid\nLAST DEPLOYED: Fri Mar "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v(" 09:22:32 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2021")]),e._v("\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\nTEST SUITE: None\n")])])]),t("p",[e._v("The old version of controller will not terminate automatically, the new version will stay in the Pending status：")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ kubectl -n fluid-system get pods\nNAME                                         READY   STATUS    RESTARTS   AGE\nalluxioruntime-controller-56687869f6-g9l9n   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("/1     Pending   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          96s\nalluxioruntime-controller-5b64fdbbb-j9h6r    "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          3m55s\ncsi-nodeplugin-fluid-r6crn                   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          94s\ncsi-nodeplugin-fluid-wvhdn                   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          87s\ndataset-controller-5b7848dbbb-rjkl9          "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          3m55s\ndataset-controller-64bf45c497-w8ncb          "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("/1     Pending   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          96s\n")])])]),t("p",[e._v("delete them manually：")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ kubectl -n fluid-system delete pod alluxioruntime-controller-5b64fdbbb-j9h6r \n$ kubectl -n fluid-system delete pod dataset-controller-5b7848dbbb-rjkl9\n")])])]),t("blockquote",[t("p",[e._v("We recommend you to update from v0.3 and v0.4. If you have an older version, you'd better to reinstall it.")])]),e._v(" "),t("h3",{attrs:{id:"check-status-of-component"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#check-status-of-component"}},[e._v("#")]),e._v(" Check Status of Component")]),e._v(" "),t("p",[t("strong",[e._v("Check CRD used by Fluid:")])]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ kubectl get crd "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" data.fluid.io\nalluxiodataloads.data.fluid.io          "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-07-24T06:54:50Z\nalluxioruntimes.data.fluid.io           "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-07-24T06:54:50Z\ndatasets.data.fluid.io                  "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-07-24T06:54:50Z\ndataloads.data.fluid.io                 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2021")]),e._v("-03-12T00:00:47Z\ndatasets.data.fluid.io                  "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2021")]),e._v("-03-12T00:00:47Z\njindoruntimes.data.fluid.io             "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2021")]),e._v("-03-12T00:03:45Z\n")])])]),t("p",[t("strong",[e._v("Check the status of pods:")])]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ kubectl get pod -n fluid-system\nNAME                                  READY   STATUS    RESTARTS   AGE\nalluxioruntime-controller-5dfb5c7966-mkgzb   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          2d1h\ncsi-nodeplugin-fluid-64h69                   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          2d1h\ncsi-nodeplugin-fluid-tc7fx                   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          2d1h\ndataset-controller-7c4bc68b96-26mcb          "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          2d1h\n")])])]),t("p",[e._v("If the Pod status is as shown above, then Fluid is installed on your Kubernetes cluster successfully!")]),e._v(" "),t("h3",{attrs:{id:"check-version-info-of-component"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#check-version-info-of-component"}},[e._v("#")]),e._v(" Check version info of Component")]),e._v(" "),t("p",[e._v("When csi-nodeplugin, alluxioruntime-controller and dataset-controller start，they will print their own version info into logs."),t("br"),e._v("\nIf you installed with the charts provided by us，their version info will be fully consistent."),t("br"),e._v("\nIf you installed manually, their version info may be not consistent. You can view in turn:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ kubectl logs csi-nodeplugin-fluid-tc7fx -c plugins  -n fluid-system "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("head")]),e._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("9")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("tail")]),e._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("\n$ kubectl logs alluxioruntime-controller-5dfb5c7966-mkgzb -n fluid-system "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("head")]),e._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("\n$ kubectl logs dataset-controller-7c4bc68b96-26mcb  -n fluid-system "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("head")]),e._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v("\n")])])]),t("p",[e._v("The printed logs are in the following format:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("/10/27 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(":16:02 BuildDate: "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-10-26_14:04:22\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("/10/27 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(":16:02 GitCommit: f2c3a3fa1335cb0384e565f17a4f3284a6507cef\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("/10/27 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(":16:02 GitTreeState: dirty\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("/10/27 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(":16:02 GoVersion: go1.14.2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("/10/27 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(":16:02 Compiler: gc\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("/10/27 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(":16:02 Platform: linux/amd64\n")])])]),t("p",[e._v("If the logs printed by Pod have been cleaned up, you can run the following command to view the version:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" csi-nodeplugin-fluid-tc7fx -c plugins  fluid-csi version -n fluid-system\n$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" alluxioruntime-controller-5dfb5c7966-mkgzb alluxioruntime-controller version -n fluid-system\n$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" dataset-controller-7c4bc68b96-26mcb dataset-controller version -n  fluid-system \n")])])]),t("h3",{attrs:{id:"fluid-use-cases"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fluid-use-cases"}},[e._v("#")]),e._v(" Fluid use cases")]),e._v(" "),t("p",[e._v("For more use cases about Fluid, please refer to our demos:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/samples/"}},[e._v("Speed Up Accessing Remote Files")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/samples/data_co_locality.html"}},[e._v("Cache Co-locality for Workload Scheduling")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/samples/machinelearning.html"}},[e._v("Accelerate Machine Learning Training with Fluid")])],1)]),e._v(" "),t("h3",{attrs:{id:"uninstall-fluid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uninstall-fluid"}},[e._v("#")]),e._v(" Uninstall Fluid")]),e._v(" "),t("p",[e._v("For uninstalling fluid safely, we should check weather Custom Resource Objects about fluid have been deleted completely first:")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("kubectl get crds -o custom-columns"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("NAME:.metadata.name "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" data.fluid.io  "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("':t;N;s/\\n/,/;b t'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("xargs")]),e._v(" kubectl get --all-namespaces\n")])])]),t("p",[e._v("If you confirm that all Custom resource objects about fluid have been deleted, you can safely uninstall fluid:")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ helm delete fluid\n$ kubectl delete -f fluid/crds\n$ kubectl delete ns fluid-system\n")])])]),t("blockquote",[t("p",[e._v("The "),t("code",[e._v("fluid")]),e._v(" in command "),t("code",[e._v("helm delete")]),e._v(" means the <RELEASE_NAME> during installation.")])]),e._v(" "),t("h3",{attrs:{id:"advanced-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#advanced-configuration"}},[e._v("#")]),e._v(" Advanced Configuration")]),e._v(" "),t("p",[e._v("In some cloud vendors, the default mount root directory "),t("code",[e._v("/runtime-mnt")]),e._v(" is not writable, so you have to modify the directory location")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("helm install fluid --set runtime.mountRoot=/var/lib/docker/runtime-mnt fluid\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);